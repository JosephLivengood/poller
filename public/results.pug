//DATA PASSED THROUGH:
//
//poll[question, category, posterid, totalrespones]
//results[{id, answer, result},...]
//date
//latest[$RESPONSECODE(0/1/2/3/4/5/6/7/8/9),...] 0<length<21 (ie. [1,2,1,1,1,3,3,3,4,2,1,0])
//latestunique[$RESPONSECODE(0/1/2/3/4/5/6/7/8/9),...] no duplicates (ie. [0,1,2,3,4])

doctype html
html(lang="en")
    head
        include universal/head
    body
        include universal/nav
        block content
            .main.container
                .row
                  .col-md-6.col-md-offset-3
                    center
                        h2 #{pollinfo[0]}
                        p #{pollinfo[4]} Responses!
                        - for(var i = 0; i < results.length; i++) {
                        p #{results[i].answer}: #{percentize(results[i].result/pollinfo[3])}% (#{results[i].result})
                        - }
                        .progress
                            .progress-bar.progress-bar-success.active.progress-bar-striped#result1(role='progressbar', style='width:1%')
                                | #{results[0].answer}
                            .progress-bar.progress-bar-warning#result2(role='progressbar', style='width:1%')
                                | #{results[1].answer}
                            .progress-bar.progress-bar-danger#result3(role='progressbar', style='width:1%')
                                | #{results[2].answer}
                        hr
                        p Asked by user <strong> anon </strong> on #{prettyDate(date)} !
        include universal/script
        //#{pollinfo[2]}
        script.
            test = "#{latest} AND #{latestunique}"
            top1 = "#{percentize(results[0].result/pollinfo[3])}";
            document.getElementById("result1").style.width = top1+'%';
            top2 = "#{percentize(results[1].result/pollinfo[3])}";
            document.getElementById("result2").style.width = top2+'%';
            top3 = "#{percentize(results[2].result/pollinfo[3])}";
            document.getElementById("result3").style.width = top3+'%';

//FUNCTIONS
-function percentize(i){
    -var j = Math.round(i * 1000) / 10;
    -return j;
-}

-function prettyDate(dateString){
    -var d = date.getDate(dateString);
    -var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
    -var m = monthNames[date.getMonth()];
    -var y = date.getFullYear();
    -return m+' '+d+' '+y;
-}